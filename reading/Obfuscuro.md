This paper proposes a commodity hardware assisted program obfuscation method, Obfuscuro, to mitigate several side-channel attacks. Obfuscuro maintains Path ORAM structures, i.e, position map, stash, and ORAM tree in the trusted execution environment. The Path ORAM algorithm of data access has already been shown to be oblivious and secure because of the existence of dummy nodes, and new node randomization. In the design of Obfuscuro, a native program is repurposed into ORAM-compatible memory layouts. Each code and data access is performed in a fixed size, i.e., a single cache-line. The code block starts with data access instructions and ends with control flow conversion instructions. This way, a native program can be executed by the conjunction of several code blocks, each containing one data access operation.

There are several key ideas in Obfuscuro to prevent side-channel attacks. First, the cmov instruction in x86 to stream the whole data structure, including the position map, and stash. This prevents sensitive data leakage. Second, a register-based stash mechanism can additionally help stop trace memory access. However, such a mechanism might be limited by the size of registers, e.g., AVX2 hardware desktop only has 32 B memory, only capable of small ORAM tree size. Third, memory accesses are mapped from the native program to the ORAM tree, by operating the ORAM operations in the block level. Fourth, two fixed addresses are used to access code and data blocks.

A thorough security analysis understands the efficacy of access pattern attacks. Together, an empirical study on six applications shows that the confusion matrix of the obfuscated program can significantly hide the memory access patterns compared with the native program. For timing attacks, the paper evaluates the time taken for executing individual code blocks in C-Pad and the whole program. All demonstrate that such timing-based side-channel is infeasible with Obfuscuro. The performance overhead on average is 83X slowdown in the cmov-based stash and 51X in the register-based stash.
