#### Thread-aware Grey-box Fuzzing for Effective Bug Hunting in Multithreaded Programs

#### Summary

This paper proposes MUZZ, a grey-box fuzzing framework for detecting concurrency bugs and concurrency vulnerabilities in input-dependent user-space multithreaded programs. To generate inputs to exercise multithreading context and thread-interleaving execution states, MUZZ first performs a static analysis to collect thread-aware information, MUZZ then, uses it to instrument the relevant instructions with three new instrumentation strategies. MUZZ uses 1) coverage-oriented instrumentation to capture more precise transition and prioritize related seeds. To balance the instrumentation overhead and fuzzing performance, MUZZ applies a cyclomatic complexity based probability to selectively instrument part of the thread-aware code. 2) thread-context instrumentation to identify different threads, and 3) schedule-intervention instrumentation to forcely diversify the thread-interleaving. MUZZ further prioritizes the inputs in the seed queue that can reach the thread-aware instructions and checks concurrency bugs and vulnerabilities. The paper thoroughly evaluates the effectiveness of the instrumentation strategies and bug detection by comparing MUZZ with state-of-art fuzzers (AFL and MOPT) and a MUZZ variant (MAFL). The results demonstrate that the new instrumentation and seed selection strategies can help exercise thread-relevant code locations. Besides, MUZZ also outperforms other tools in detecting concurrency vulnerabilities and bugs, reporting 10 new concurrency vulnerabilities and 19 new concurrency bugs.

#### Extra thoughts

Any improvement in the loop of fuzzing process ï¼ˆAlg. 1) can help improve the effectiveness of fuzzing. The key insight of this paper lies in the new coverage metric in the fuzzer. To achieve an acceptable performance overhead, fuzzers usually use block coverage or edge coverage, i.e., whether a block/edge is visited in a path, to compute a path hash value. Fuzzers are not able to distinguish two paths in some cases due to the hash collision problem. CollAFL (S&P'18) thus proposes new hash computing methods to provide more accurate path coverage. Krace (S&P'20) uses a novel coverage metric: alias instruction pair coverage, to find data race in kernel file systems. Consider the order of the visits of blocks and edges can measure the real path coverage, while it brings too excessive performance overhead. The cyclomatic complexity based method in this paper is a good practice to tackle this problem. How to design methods to define and accurately measure path coverage for fuzzing can be a potential research direction. For sequential programs, concurrency programs, and kernels with lots of internal states, they may require different metrics for the coverage. 